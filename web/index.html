<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System B+R - Prototypowy System Modularny</title>
    <link rel="stylesheet" href="static/css/style.css?v=20260113c">
    <script src="static/js/markdown-renderer.js"></script>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
</head>
<body>
    <div id="app">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>System B+R</h1>
                <p class="company-info">Tomasz Sapletta<br>NIP: 588-191-86-62</p>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="upload">
                    <span class="nav-icon">üìÑ</span>
                    <span>Upload dokument√≥w</span>
                </li>
                <li class="nav-item" data-page="projects">
                    <span class="nav-icon">üìÅ</span>
                    <span>Projekty B+R</span>
                </li>
                <li class="nav-item" data-page="expenses">
                    <span class="nav-icon">üí∞</span>
                    <span>Wydatki B+R</span>
                </li>
                <li class="nav-item" data-page="reports">
                    <span class="nav-icon">üìà</span>
                    <span>Raporty miesiƒôczne</span>
                </li>
                <li class="nav-item" data-page="timesheet">
                    <span class="nav-icon">‚è±Ô∏è</span>
                    <span>Harmonogram prac</span>
                </li>
                <li class="nav-item" data-page="git-timesheet">
                    <span class="nav-icon">üìÇ</span>
                    <span>Harmonogram Git</span>
                </li>
                <li class="nav-item" data-page="clarifications">
                    <span class="nav-icon">‚ùì</span>
                    <span>Wyja≈õnienia</span>
                    <span class="badge" id="clarification-badge">0</span>
                </li>
                <li class="nav-item" data-page="integrations">
                    <span class="nav-icon">üîó</span>
                    <span>Integracje</span>
                </li>
                <li class="nav-item" data-page="logs">
                    <span class="nav-icon">üìã</span>
                    <span>Logi</span>
                </li>
                <li class="nav-item" data-page="ai-config">
                    <span class="nav-icon">ü§ñ</span>
                    <span>AI / OCR</span>
                </li>
                <li class="nav-item" data-page="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Ustawienia</span>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <div class="project-info">
                    <strong>Aktywny projekt:</strong><br>
                    <span id="active-project">Prototypowy system modularny</span>
                </div>
                <div class="fiscal-year">
                    Rok podatkowy: <span id="fiscal-year">2025</span>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <section id="page-dashboard" class="page active">
                <header class="page-header">
                    <h2>Dashboard</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="toggleDashboardConfig()">‚öôÔ∏è Konfiguruj</button>
                        <button class="btn btn-primary" onclick="generateAllReports()">Generuj raporty</button>
                    </div>
                </header>
                
                <!-- Dashboard Configuration Panel -->
                <div id="dashboard-config" class="dashboard-config" style="display:none;">
                    <div class="config-header">
                        <h4>Konfiguracja modu≈Ç√≥w</h4>
                        <button class="btn btn-sm btn-secondary" onclick="resetDashboardConfig()">Resetuj</button>
                    </div>
                    <div class="config-modules">
                        <label>Dodaj modu≈Ç:</label>
                        <select id="add-module-select" onchange="addDashboardModule(this.value); this.value='';">
                            <option value="">-- Wybierz modu≈Ç --</option>
                        </select>
                    </div>
                </div>
                
                <!-- Modular Dashboard Grid 4x4 -->
                <div id="dashboard-modules" class="dashboard-modules-grid">
                    <!-- Modules will be rendered by JS -->
                </div>
            </section>

            <!-- Upload Page -->
            <section id="page-upload" class="page">
                <header class="page-header">
                    <h2>Upload dokument√≥w</h2>
                </header>
                
                <div class="upload-area" id="upload-area">
                    <div class="upload-icon">üìÑ</div>
                    <h3>PrzeciƒÖgnij dokumenty tutaj</h3>
                    <p>lub kliknij, aby wybraƒá pliki</p>
                    <p class="upload-formats">Obs≈Çugiwane formaty: PDF, PNG, JPG, TIFF</p>
                    <input type="file" id="file-input" multiple accept=".pdf,.png,.jpg,.jpeg,.tiff">
                </div>
                
                <div class="upload-info">
                    <p class="auto-detect-info">üí° Typ dokumentu zostanie wykryty automatycznie na podstawie OCR</p>
                </div>
                
                <div id="upload-queue" class="upload-queue">
                    <!-- Upload queue items will be added here -->
                </div>
                
                <div class="card">
                    <h3>Ostatnio przes≈Çane</h3>
                    <div id="uploaded-documents" class="document-list">
                        <p class="empty-state">Brak przes≈Çanych dokument√≥w</p>
                    </div>
                </div>
            </section>

            <!-- Projects Page -->
            <section id="page-projects" class="page">
                <header class="page-header">
                    <h2>Projekty B+R</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="regenerateAllReports()">
                            üîÑ Regeneruj wszystkie raporty
                        </button>
                        <button class="btn btn-primary" onclick="showCreateProjectModal()">
                            ‚ûï Nowy projekt
                        </button>
                    </div>
                </header>
                
                <div class="projects-grid" id="projects-list">
                    <p class="empty-state">≈Åadowanie projekt√≥w...</p>
                </div>
            </section>
            
            <!-- Documentation Viewer Modal -->
            <div id="docs-modal" class="modal">
                <div class="modal-content modal-large">
                    <span class="modal-close" onclick="closeDocsModal()">&times;</span>
                    <h3>üìÑ Dokumentacja B+R</h3>
                    <div id="docs-modal-content">
                        <p>≈Åadowanie...</p>
                    </div>
                </div>
            </div>

            <!-- Expenses Page -->
            <section id="page-expenses" class="page">
                <header class="page-header">
                    <h2 id="expenses-page-title">Wydatki B+R</h2>
                    <div class="header-actions">
                        <select id="expense-filter-type" onchange="loadExpenses()">
                            <option value="expense">üì§ Wydatki (kosztowe)</option>
                            <option value="revenue">üì• Przychody (sprzeda≈º)</option>
                            <option value="all">üìä Wszystkie faktury</option>
                        </select>
                        <select id="expense-filter-year" onchange="loadExpenses()">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="">Wszystkie lata</option>
                        </select>
                        <select id="expense-filter-month" onchange="loadExpenses()">
                            <option value="">Wszystkie miesiƒÖce</option>
                            <option value="1">Stycze≈Ñ</option>
                            <option value="2">Luty</option>
                            <option value="3">Marzec</option>
                            <option value="4">Kwiecie≈Ñ</option>
                            <option value="5">Maj</option>
                            <option value="6">Czerwiec</option>
                            <option value="7">Lipiec</option>
                            <option value="8">Sierpie≈Ñ</option>
                            <option value="9">Wrzesie≈Ñ</option>
                            <option value="10">Pa≈∫dziernik</option>
                            <option value="11">Listopad</option>
                            <option value="12">Grudzie≈Ñ</option>
                        </select>
                        <select id="expense-filter-project" onchange="loadExpenses()">
                            <option value="">Wszystkie projekty</option>
                        </select>
                        <select id="expense-filter-status" onchange="loadExpenses()">
                            <option value="">Wszystkie statusy</option>
                            <option value="draft">Szkic</option>
                            <option value="classified">Sklasyfikowane</option>
                            <option value="approved">Zatwierdzone</option>
                        </select>
                        <select id="expense-filter-br" onchange="loadExpenses()">
                            <option value="">B+R: Wszystkie</option>
                            <option value="true">Kwalifikowane</option>
                            <option value="false">Niekwalifikowane</option>
                        </select>
                    </div>
                </header>
                
                <!-- Bulk actions bar -->
                <div class="bulk-actions-bar" id="bulk-actions-bar" style="display:none;">
                    <span id="selected-count">0 zaznaczonych</span>
                    <select id="bulk-assign-project">
                        <option value="">Przypisz do projektu...</option>
                    </select>
                    <button class="btn btn-primary btn-sm" onclick="bulkAssignToProject()">Przypisz</button>
                    <button class="btn btn-secondary btn-sm" onclick="clearSelection()">Anuluj</button>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="select-all-expenses" onchange="toggleSelectAll(this)"></th>
                                <th>Projekt</th>
                                <th>Data</th>
                                <th>Nr faktury</th>
                                <th>Dostawca</th>
                                <th>Kwota</th>
                                <th>Kategoria B+R</th>
                                <th>Status</th>
                                <th>Akcje</th>
                            </tr>
                        </thead>
                        <tbody id="expenses-table-body">
                            <tr>
                                <td colspan="9" class="empty-state">Brak wydatk√≥w</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Timesheet Page -->
            <section id="page-timesheet" class="page">
                <header class="page-header">
                    <h2>Harmonogram prac B+R</h2>
                    <div class="header-actions">
                        <select id="timesheet-worker" onchange="loadTimesheet()">
                            <option value="">Wybierz pracownika...</option>
                        </select>
                        <select id="timesheet-month" onchange="loadTimesheet()"></select>
                        <select id="timesheet-year" onchange="loadTimesheet()">
                            <option value="2026">2026</option>
                            <option value="2025" selected>2025</option>
                            <option value="2024">2024</option>
                        </select>
                        <button class="btn btn-secondary" onclick="showAddWorkerModal()">üë§ Dodaj pracownika</button>
                        <button class="btn btn-primary" onclick="saveTimesheet()">üíæ Zapisz</button>
                    </div>
                </header>
                
                <div class="timesheet-container">
                    <div class="timesheet-grid" id="timesheet-grid">
                        <p class="empty-state">Wybierz pracownika, aby wy≈õwietliƒá harmonogram</p>
                    </div>
                </div>
                
                <div class="timesheet-summary">
                    <div class="card">
                        <h3>Podsumowanie miesiƒÖca</h3>
                        <div id="timesheet-month-summary">
                            <p class="empty-state">Brak danych</p>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Kooperanci (z faktur)</h3>
                        <div id="contractors-list">
                            <p class="empty-state">≈Åadowanie...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Git Timesheet Page -->
            <section id="page-git-timesheet" class="page">
                <header class="page-header">
                    <h2>Harmonogram z historii Git</h2>
                    <div class="header-actions">
                        <select id="git-timesheet-worker" class="worker-select">
                            <option value="">-- Wybierz pracownika --</option>
                        </select>
                        <button class="btn btn-primary" onclick="generateGitTimesheet()" id="btn-generate-git-ts" disabled>
                            üìä Generuj harmonogram
                        </button>
                    </div>
                </header>
                
                <div class="git-timesheet-container">
                    <!-- Step 1: Scan Configuration -->
                    <div class="card">
                        <h3>1Ô∏è‚É£ Skanowanie repozytori√≥w Git</h3>
                        <div class="git-scan-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>≈öcie≈ºka do folderu:</label>
                                    <input type="text" id="git-folder-path" placeholder="/repos/user/projects" value="/repos">
                                </div>
                                <div class="form-group">
                                    <label>G≈Çƒôboko≈õƒá skanowania:</label>
                                    <select id="git-scan-depth">
                                        <option value="1">1 poziom</option>
                                        <option value="2">2 poziomy</option>
                                        <option value="3" selected>3 poziomy</option>
                                        <option value="4">4 poziomy</option>
                                    </select>
                                </div>
                                <div class="form-group form-actions">
                                    <button class="btn btn-primary" onclick="scanGitRepos()">üîç Skanuj</button>
                                </div>
                            </div>
                        </div>
                        <div id="git-scan-results" class="git-scan-results">
                            <p class="empty-state">Wprowad≈∫ ≈õcie≈ºkƒô i kliknij "Skanuj"</p>
                        </div>
                    </div>
                    
                    <!-- Step 2: Author Selection -->
                    <div class="card" id="git-authors-section" style="display:none;">
                        <h3>2Ô∏è‚É£ Wyb√≥r autor√≥w</h3>
                        <p class="card-description">Zaznacz autor√≥w, kt√≥rych commity majƒÖ byƒá uwzglƒôdnione w harmonogramie</p>
                        <div id="git-authors-list" class="git-authors-list">
                            <p class="empty-state">Najpierw wykonaj skanowanie</p>
                        </div>
                    </div>
                    
                    <!-- Step 3: Repository Selection -->
                    <div class="card" id="git-repos-section" style="display:none;">
                        <h3>3Ô∏è‚É£ Mapowanie repozytori√≥w na projekty B+R</h3>
                        <p class="card-description">Przypisz repozytoria Git do projekt√≥w B+R (kolumny = projekty B+R, wiersze = repozytoria Git)</p>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Zakres dat:</label>
                                <input type="date" id="git-date-since" value="">
                            </div>
                            <div class="form-group">
                                <label>Do:</label>
                                <input type="date" id="git-date-until" value="">
                            </div>
                            <div class="form-group form-actions">
                                <button class="btn btn-secondary" onclick="loadGitCommits()">üì• Pobierz commity</button>
                            </div>
                        </div>
                        <div id="git-repo-mapping" class="git-repo-mapping">
                            <p class="empty-state">Najpierw wykonaj skanowanie i wybierz autor√≥w</p>
                        </div>
                    </div>
                    
                    <!-- Step 4: Commits Preview -->
                    <div class="card" id="git-commits-section" style="display:none;">
                        <h3>4Ô∏è‚É£ PodglƒÖd commit√≥w</h3>
                        <div class="git-commits-stats">
                            <span id="git-commits-count">0 commit√≥w</span>
                            <span id="git-commits-days">0 dni</span>
                        </div>
                        <div id="git-commits-preview" class="git-commits-preview">
                            <p class="empty-state">Pobierz commity aby zobaczyƒá podglƒÖd</p>
                        </div>
                    </div>
                    
                    <!-- Step 5: Generated Timesheet -->
                    <div class="card" id="git-timesheet-result" style="display:none;">
                        <h3>5Ô∏è‚É£ Wygenerowany harmonogram</h3>
                        <div id="git-timesheet-grid" class="timesheet-grid">
                            <p class="empty-state">Kliknij "Generuj harmonogram" aby utworzyƒá wpisy</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports Page -->
            <section id="page-reports" class="page">
                <header class="page-header">
                    <h2>Raporty miesiƒôczne</h2>
                    <div class="header-actions">
                        <select id="report-year" onchange="loadReports()">
                            <option value="2026">2026</option>
                            <option value="2025" selected>2025</option>
                            <option value="2024">2024</option>
                        </select>
                        <button class="btn btn-secondary" onclick="regenerateAllMonthlyReports()">
                            üîÑ Regeneruj wszystkie
                        </button>
                        <button class="btn btn-primary" onclick="generateMonthlyReport()">
                            ‚ûï Generuj miesiƒÖc
                        </button>
                    </div>
                </header>
                
                <div class="reports-grid">
                    <div class="card report-summary">
                        <h3>üìä Podsumowanie roczne B+R</h3>
                        <div id="annual-br-summary">
                            <p class="empty-state">Wybierz rok i wygeneruj raport</p>
                        </div>
                    </div>
                    <div class="card report-summary">
                        <h3>üéØ Podsumowanie IP Box</h3>
                        <div id="annual-ip-summary">
                            <p class="empty-state">Wybierz rok i wygeneruj raport</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üìÖ Szczeg√≥≈Çy miesiƒôczne</h3>
                    <div class="table-container">
                        <table class="data-table" id="monthly-details-table">
                            <thead>
                                <tr>
                                    <th>MiesiƒÖc</th>
                                    <th>Wydatki</th>
                                    <th>B+R kwalifik.</th>
                                    <th>Przychody</th>
                                    <th>IP Box</th>
                                    <th>Nexus</th>
                                    <th>Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="monthly-reports-body">
                                <tr><td colspan="7" class="empty-state">≈Åadowanie...</td></tr>
                            </tbody>
                            <tfoot id="monthly-reports-footer">
                                <tr class="totals-row">
                                    <td><strong>RAZEM</strong></td>
                                    <td id="total-expenses">-</td>
                                    <td id="total-br">-</td>
                                    <td id="total-revenues">-</td>
                                    <td id="total-ip">-</td>
                                    <td id="avg-nexus">-</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <div class="card" id="month-detail-card" style="display:none;">
                    <h3 id="month-detail-title">üìã Szczeg√≥≈Çy miesiƒÖca</h3>
                    <div id="month-detail-content">
                        <p class="empty-state">Wybierz miesiƒÖc aby zobaczyƒá szczeg√≥≈Çy</p>
                    </div>
                </div>
            </section>

            <!-- Clarifications Page -->
            <section id="page-clarifications" class="page">
                <header class="page-header">
                    <h2>Wyja≈õnienia</h2>
                    <div class="header-actions">
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-unanswered" checked>
                            Tylko bez odpowiedzi
                        </label>
                    </div>
                </header>
                
                <div id="clarifications-list" class="clarifications-list">
                    <p class="empty-state">Brak pyta≈Ñ wymagajƒÖcych wyja≈õnienia</p>
                </div>
            </section>

            <!-- Integrations Page -->
            <section id="page-integrations" class="page">
                <header class="page-header">
                    <h2>Integracje</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showAddIntegrationModal()">
                            + Dodaj integracjƒô
                        </button>
                    </div>
                </header>
                
                <div class="integrations-container">
                    <!-- Accounting Integrations -->
                    <div class="card">
                        <h3>üìä Programy ksiƒôgowe</h3>
                        <p class="card-description">Automatyczny import faktur kosztowych do systemu B+R</p>
                        
                        <div id="accounting-integrations" class="integrations-list">
                            <div class="integration-placeholder">
                                <p>Brak skonfigurowanych integracji ksiƒôgowych</p>
                                <button class="btn btn-outline" onclick="showAddIntegrationModal('accounting')">
                                    Dodaj integracjƒô
                                </button>
                            </div>
                        </div>
                        
                        <div class="available-providers">
                            <h4>Dostƒôpne programy:</h4>
                            <div class="provider-badges">
                                <span class="provider-badge" data-provider="ifirma">iFirma</span>
                                <span class="provider-badge" data-provider="fakturownia">Fakturownia</span>
                                <span class="provider-badge" data-provider="wfirma">wFirma</span>
                                <span class="provider-badge" data-provider="infakt">InFakt</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cloud Storage Integrations -->
                    <div class="card">
                        <h3>‚òÅÔ∏è Magazyn w chmurze</h3>
                        <p class="card-description">Automatyczny upload raport√≥w miesiƒôcznych do chmury</p>
                        
                        <div id="cloud-integrations" class="integrations-list">
                            <div class="integration-placeholder">
                                <p>Brak skonfigurowanych integracji chmurowych</p>
                                <button class="btn btn-outline" onclick="showAddIntegrationModal('cloud_storage')">
                                    Dodaj integracjƒô
                                </button>
                            </div>
                        </div>
                        
                        <div class="available-providers">
                            <h4>Dostƒôpne us≈Çugi:</h4>
                            <div class="provider-badges">
                                <span class="provider-badge" data-provider="nextcloud">Nextcloud</span>
                                <span class="provider-badge" data-provider="google_drive">Google Drive</span>
                                <span class="provider-badge" data-provider="dropbox">Dropbox</span>
                                <span class="provider-badge" data-provider="onedrive">OneDrive</span>
                                <span class="provider-badge" data-provider="aws_s3">AWS S3</span>
                                <span class="provider-badge" data-provider="minio">MinIO</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sync Actions -->
                    <div class="card">
                        <h3>üîÑ Akcje synchronizacji</h3>
                        
                        <div class="sync-actions">
                            <div class="sync-action">
                                <div class="sync-info">
                                    <strong>Synchronizuj faktury</strong>
                                    <p>Pobierz wszystkie faktury z program√≥w ksiƒôgowych</p>
                                </div>
                                <button class="btn btn-primary" onclick="syncAllInvoices()">
                                    Synchronizuj
                                </button>
                            </div>
                            
                            <div class="sync-action">
                                <div class="sync-info">
                                    <strong>Upload raport√≥w</strong>
                                    <p>Wy≈õlij raporty miesiƒôczne do wszystkich magazyn√≥w chmurowych</p>
                                </div>
                                <button class="btn btn-primary" onclick="uploadAllReports()">
                                    Wy≈õlij raporty
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sync Logs -->
                    <div class="card">
                        <h3>üìã Historia synchronizacji</h3>
                        <div id="sync-logs-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Integracja</th>
                                        <th>Typ</th>
                                        <th>Status</th>
                                        <th>Elementy</th>
                                    </tr>
                                </thead>
                                <tbody id="sync-logs-table">
                                    <tr>
                                        <td colspan="5" class="empty-state">Brak historii synchronizacji</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Logs Page -->
            <section id="page-logs" class="page">
                <header class="page-header">
                    <h2>Logi systemowe</h2>
                    <div class="header-actions">
                        <button class="btn btn-outline" onclick="clearAllLogs()">
                            üóë Wyczy≈õƒá wszystkie
                        </button>
                        <button class="btn btn-secondary" onclick="reconnectAllLogs()">
                            üîÑ Od≈õwie≈º
                        </button>
                    </div>
                </header>
                
                <div class="logs-tabs-container">
                    <div class="logs-tabs">
                        <button class="log-tab active" data-service="api" onclick="switchLogTab('api')">
                            <span class="tab-dot" id="dot-api"></span> API
                        </button>
                        <button class="log-tab" data-service="ocr" onclick="switchLogTab('ocr')">
                            <span class="tab-dot" id="dot-ocr"></span> OCR
                        </button>
                        <button class="log-tab" data-service="llm" onclick="switchLogTab('llm')">
                            <span class="tab-dot" id="dot-llm"></span> LLM
                        </button>
                        <button class="log-tab" data-service="web" onclick="switchLogTab('web')">
                            <span class="tab-dot" id="dot-web"></span> Web
                        </button>
                        <button class="log-tab" data-service="postgres" onclick="switchLogTab('postgres')">
                            <span class="tab-dot" id="dot-postgres"></span> DB
                        </button>
                    </div>
                    
                    <div class="log-panels">
                        <div class="log-panel active" id="log-panel-api">
                            <button class="btn-copy-logs" onclick="copyLogs('api')" title="Kopiuj logi">üìã</button>
                            <pre class="log-output" id="log-output-api"></pre>
                        </div>
                        <div class="log-panel" id="log-panel-ocr">
                            <button class="btn-copy-logs" onclick="copyLogs('ocr')" title="Kopiuj logi">üìã</button>
                            <pre class="log-output" id="log-output-ocr"></pre>
                        </div>
                        <div class="log-panel" id="log-panel-llm">
                            <button class="btn-copy-logs" onclick="copyLogs('llm')" title="Kopiuj logi">üìã</button>
                            <pre class="log-output" id="log-output-llm"></pre>
                        </div>
                        <div class="log-panel" id="log-panel-web">
                            <button class="btn-copy-logs" onclick="copyLogs('web')" title="Kopiuj logi">üìã</button>
                            <pre class="log-output" id="log-output-web"></pre>
                        </div>
                        <div class="log-panel" id="log-panel-postgres">
                            <button class="btn-copy-logs" onclick="copyLogs('postgres')" title="Kopiuj logi">üìã</button>
                            <pre class="log-output" id="log-output-postgres"></pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- AI Config Page -->
            <section id="page-ai-config" class="page">
                <header class="page-header">
                    <h2>Konfiguracja AI / OCR</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="saveAIConfig()">üíæ Zapisz</button>
                        <button class="btn btn-outline" onclick="testConnections()">üîç Testuj po≈ÇƒÖczenia</button>
                    </div>
                </header>
                
                <div class="ai-config-grid">
                    <!-- OCR Config -->
                    <div class="card">
                        <h3>üî§ Silniki OCR</h3>
                        <div class="form-group">
                            <label>G≈Ç√≥wny silnik:</label>
                            <select id="ocr-primary-engine">
                                <option value="paddleocr">PaddleOCR (szybki, dok≈Çadny)</option>
                                <option value="tesseract">Tesseract (klasyczny, stabilny)</option>
                                <option value="easyocr">EasyOCR (wielojƒôzyczny)</option>
                                <option value="doctr">DocTR (transformer, dok≈Çadny)</option>
                                <option value="surya">Surya (layout detection)</option>
                                <option value="trocr">TrOCR (rƒôkopis)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Strategia:</label>
                            <select id="ocr-strategy">
                                <option value="single">Pojedynczy silnik</option>
                                <option value="fallback" selected>Fallback (kolejne silniki)</option>
                                <option value="ensemble">Ensemble (≈ÇƒÖczenie wynik√≥w)</option>
                                <option value="field_specific">Specyficzny dla pola</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Min. pewno≈õƒá OCR:</label>
                            <input type="range" id="ocr-min-confidence" min="0" max="100" value="75">
                            <span id="ocr-confidence-value">75%</span>
                        </div>
                        <div class="form-group">
                            <label>Jƒôzyk:</label>
                            <select id="ocr-language">
                                <option value="pol" selected>Polski</option>
                                <option value="eng">Angielski</option>
                                <option value="deu">Niemiecki</option>
                                <option value="fra">Francuski</option>
                            </select>
                        </div>
                        <div class="form-group checkbox-group">
                            <label><input type="checkbox" id="ocr-use-gpu" checked> U≈ºyj GPU</label>
                            <label><input type="checkbox" id="ocr-field-specific" checked> U≈ºywaj najlepszego silnika dla pola</label>
                        </div>
                    </div>
                    
                    <!-- LLM Config -->
                    <div class="card">
                        <h3>üß† Model LLM</h3>
                        <div class="form-group">
                            <label>Provider:</label>
                            <select id="llm-provider" onchange="updateModelList()">
                                <option value="ollama" selected>Ollama (lokalny)</option>
                                <option value="openai">OpenAI</option>
                                <option value="anthropic">Anthropic</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Model:</label>
                            <select id="llm-model">
                                <option value="llama3.2">Llama 3.2 (3B)</option>
                                <option value="llama3.1:8b">Llama 3.1 (8B)</option>
                                <option value="mistral">Mistral 7B</option>
                                <option value="gemma2:9b">Gemma 2 (9B)</option>
                                <option value="qwen2.5:7b">Qwen 2.5 (7B)</option>
                                <option value="phi3">Phi-3</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>API Base URL:</label>
                            <input type="text" id="llm-api-base" value="http://host.docker.internal:11434">
                        </div>
                        <div class="form-group">
                            <label>API Key (opcjonalnie):</label>
                            <input type="password" id="llm-api-key" placeholder="sk-...">
                        </div>
                        <div class="form-group">
                            <label>Temperatura: <span id="llm-temp-value">0.1</span></label>
                            <input type="range" id="llm-temperature" min="0" max="100" value="10" oninput="document.getElementById('llm-temp-value').textContent = (this.value/100).toFixed(2)">
                        </div>
                        <div class="form-group checkbox-group">
                            <label><input type="checkbox" id="llm-use-extraction" checked> Ekstrakcja danych</label>
                            <label><input type="checkbox" id="llm-use-classification" checked> Klasyfikacja dokument√≥w</label>
                            <label><input type="checkbox" id="llm-use-validation" checked> Walidacja danych</label>
                        </div>
                    </div>
                    
                    <!-- Engines Info -->
                    <div class="card card-full">
                        <h3>üìä Dostƒôpne silniki OCR</h3>
                        <div id="ocr-engines-list" class="engines-grid">
                            <!-- Loaded dynamically -->
                        </div>
                    </div>
                    
                    <!-- Document Types -->
                    <div class="card card-full">
                        <h3>üìÑ Typy dokument√≥w i zalecane silniki</h3>
                        <div id="document-types-list" class="doc-types-grid">
                            <!-- Loaded dynamically -->
                        </div>
                    </div>
                    
                    <!-- Connection Status -->
                    <div class="card card-full">
                        <h3>üîå Status po≈ÇƒÖcze≈Ñ</h3>
                        <div id="connection-status" class="connection-grid">
                            <div class="connection-item">
                                <span class="connection-name">OCR Service</span>
                                <span class="connection-status" id="status-ocr">‚è≥ Sprawdzanie...</span>
                            </div>
                            <div class="connection-item">
                                <span class="connection-name">LLM Service</span>
                                <span class="connection-status" id="status-llm">‚è≥ Sprawdzanie...</span>
                            </div>
                            <div class="connection-item">
                                <span class="connection-name">Ollama</span>
                                <span class="connection-status" id="status-ollama">‚è≥ Sprawdzanie...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Page -->
            <section id="page-settings" class="page">
                <header class="page-header">
                    <h2>Ustawienia</h2>
                </header>
                
                <div class="settings-grid">
                    <div class="card">
                        <h3>Dane firmy</h3>
                        <div class="form-group">
                            <label>Nazwa firmy:</label>
                            <input type="text" id="setting-company-name" value="Tomasz Sapletta" readonly>
                        </div>
                        <div class="form-group">
                            <label>NIP:</label>
                            <input type="text" id="setting-nip" value="5881918662" readonly>
                        </div>
                        <div class="form-group">
                            <label>PKD:</label>
                            <input type="text" id="setting-pkd" value="72.10.Z" readonly>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Projekty B+R</h3>
                        <p>ZarzƒÖdzaj projektami B+R w dedykowanej zak≈Çadce.</p>
                        <button class="btn btn-primary" onclick="navigateTo('projects')">
                            üìÅ Przejd≈∫ do projekt√≥w
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3>Integracje</h3>
                        <div class="integration-status">
                            <div class="integration-item">
                                <span class="status-dot green"></span>
                                <span>OCR Service</span>
                            </div>
                            <div class="integration-item">
                                <span class="status-dot green"></span>
                                <span>LLM Service</span>
                            </div>
                            <div class="integration-item">
                                <span class="status-dot green"></span>
                                <span>Database</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal for expense details -->
    <div id="expense-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h3>Szczeg√≥≈Çy wydatku</h3>
            <div id="expense-modal-content">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Modal for adding integration -->
    <div id="integration-modal" class="modal">
        <div class="modal-content modal-lg">
            <span class="modal-close" onclick="closeIntegrationModal()">&times;</span>
            <h3 id="integration-modal-title">Dodaj integracjƒô</h3>
            
            <form id="integration-form" onsubmit="saveIntegration(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="integration-id">ID integracji:</label>
                        <input type="text" id="integration-id" required placeholder="np. moja-ifirma">
                    </div>
                    <div class="form-group">
                        <label for="integration-type">Typ:</label>
                        <select id="integration-type" required onchange="updateProviderOptions()">
                            <option value="">Wybierz typ...</option>
                            <option value="accounting">Program ksiƒôgowy</option>
                            <option value="cloud_storage">Magazyn chmurowy</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="integration-provider">Dostawca:</label>
                    <select id="integration-provider" required onchange="updateCredentialFields()">
                        <option value="">Najpierw wybierz typ...</option>
                    </select>
                </div>
                
                <div id="credential-fields">
                    <!-- Dynamic credential fields -->
                </div>
                
                <div class="form-group">
                    <label for="integration-base-url">URL bazowy (opcjonalnie):</label>
                    <input type="url" id="integration-base-url" placeholder="https://api.example.com">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeIntegrationModal()">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zapisz integracjƒô</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Document Detail Modal -->
    <div class="modal" id="document-modal">
        <div class="modal-content modal-large">
            <button class="modal-close" onclick="closeDocumentModal()">&times;</button>
            <div id="document-modal-content">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <button id="global-logs-toggle" class="global-logs-toggle" onclick="toggleGlobalLogs()">
        üìã Logi
    </button>

    <div id="global-logs-overlay" class="global-logs-overlay">
        <div class="global-logs-header">
            <strong>Logi (live)</strong>
            <div class="global-logs-actions">
                <button class="btn btn-sm btn-outline" onclick="clearGlobalLogs()">Wyczy≈õƒá</button>
                <button class="btn btn-sm btn-secondary" onclick="toggleGlobalLogs()">Zamknij</button>
            </div>
        </div>
        <div class="global-logs-tabs">
            <button class="global-log-tab active" data-service="api" onclick="switchGlobalLogTab('api')">API</button>
            <button class="global-log-tab" data-service="ocr" onclick="switchGlobalLogTab('ocr')">OCR</button>
            <button class="global-log-tab" data-service="llm" onclick="switchGlobalLogTab('llm')">LLM</button>
            <button class="global-log-tab" data-service="web" onclick="switchGlobalLogTab('web')">WEB</button>
            <button class="global-log-tab" data-service="postgres" onclick="switchGlobalLogTab('postgres')">DB</button>
        </div>
        <div class="global-logs-panels">
            <pre class="global-log-output active" id="global-log-output-api"></pre>
            <pre class="global-log-output" id="global-log-output-ocr"></pre>
            <pre class="global-log-output" id="global-log-output-llm"></pre>
            <pre class="global-log-output" id="global-log-output-web"></pre>
            <pre class="global-log-output" id="global-log-output-postgres"></pre>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container"></div>

    <script src="static/js/app.js?v=20260113f"></script>
</body>
</html>
